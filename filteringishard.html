<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Why filtering is hard?</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/cssbase-min.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/cssreset-min.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/cssfonts-min.css">
    <link rel="stylesheet" href="stylesheets/security.css" type="text/css" />

    <!-- Bootstrap -->
    <link href="stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <link href="stylesheets/blog.css" rel="stylesheet">
    <link href="stylesheets/carousel.css" rel="stylesheet">

    <!-- jquery -->
    <script src="javascripts/jquery.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9] >
      <script src="javascripts/html5shiv.min.js"></script>
      <script src="javascripts/respond.min.js"></script>
    <![endif]-->
  </head>

    <body>
    <div class="header">
      <h1 class="header-logo">
      </h1>
    </div>

        <div class="blog-masthead">
          <div class="container">
            <nav class="blog-nav">
              <a class="blog-nav-item active" href="./">Safe JS Templating</a>
              <a class="blog-nav-item " href="./gettingstart.html">Getting Started</a>
              <a class="blog-nav-item " href="./demosSecureHandlebars.html">Demos</a>
              <a class="blog-nav-item " href="./bugBounty.html">Bug Bounty</a>
            </nav>
          </div>
        </div>

    <div class="container">
      <!-- grid system: http://getbootstrap.com/css/#grid -->
      <div class="row">
        <div class="col-md-12 blog-main">
          <h2 class="header-badge">Why filtering is hard?</h2>
          <p class="text-center">Cross Site Scripting (XSS) has been ranked among Top 3 in the OWASP Top 10 for more than a decade!</p>
        </div> <!-- blog main -->

        <div class="col-md-8 blog-post">
          <br>
          <div class="col-md-12 blog-post">
            <h2>Cross-Site Scripting</h2>
            <p class="text-justify">Cross Site Scripting (XSS) has been ranked among Top 3 in the OWASP Top 10 for more than a decade. Web applications taking untrusted user inputs, keeping them intact without proper validations, and sending them back as part of the HTML are vulnerable to XSS. Attackers can execute arbitrary JavaScript in the vulnerable application, deface the website, and even steal users’ sessions and personal information. Given these severe consequences, XSS is unarguably a critical vulnerability.</p>
          </div><!-- blog-post -->

          <div class="col-md-12 blog-post">
            <h2>Input Validation v.s. Output Filtering</h2>
            <p class="text-justify">User input validation is implemented at the server-side, often as the first interface to validate all inputs before further processing; whereas output filtering is implemented as the last output component, right before the data is sent back to user’s browsers as shown in Figure 1 below.</p>
            
            <p class="text-justify"><img src="assets/images/input-validation-output-filtering.png"/>Figure 1 - Input Validation v.s. Output Filtering</p>
            
            <p class="text-justify">Input validation and output filtering have their respective pros and cons, and it really depends on the use cases of a web application to apply either one, or both.</p>

            <p class="text-justify">Nevertheless, input filtering has a fundamental limitation. Being the first interfacing component of the system, it's hard to anticipate how downstream components act on the data. This's especially true when developing web applications at scale, in which many internal and external APIs are interacting with each other. Oftentimes, a system uses the same inputs to build a plaintext output, for which no HTML escaping is ever needed. As a result, input filtering can either be over- or insufficiently-filtering. While the former case will definitely hurt usability, the latter one will even lead to XSS vulnerabilities. In this regard, output escaping is more suitable as to judge what filters are needed by being the last output component.</p>
          </div><!-- blog-post -->

          <div class="col-md-12 blog-post">
            <h2>Output Contexts</h2>
            <p class="text-justify">It's still a complicated problem for developers to stop XSS with the output filtering approach. There're 4 common supersets of output contexts, including HTML, CSS, JavaScript and URI. An output context can be very fine-grained and even compounded too (e.g., URI in a double-quoted HTML attribute value). Even if only HTML and URI contexts are taken into considerations, there're already more than 25 output contexts.</p>
            
            <p><img src="assets/images/multiple-contexts.png" style="margin:0 -15px;width:104%"/>Figure 2 - User input at the "href" of the attribute value.</p>

            <p class="text-justify">Besides these many combinations of output contexts, the filtering order is also critical for correct encoding. The filters must observe and be built in the same execution order as in web browsers. As a XSS defense, a URI protocol filter is also required as the last filtering rule for the URI context. Given an untrusted user input to be outputed in the “href” attribute value as shown in Figure 2, the correct order is to first apply URI encoding, then HTML double-quoted attribute value escaping, and finally the URI protocol blacklist to make it secure.</p>
          </div><!-- blog-post -->
        </div><!-- col-md-8 blog-post -->

        <div class="col-md-3 col-md-offset-1 blog-sidebar">
          <div class="sidebar-module sidebar-module-inset">
          <h4>What's OWASP</h4>
          <p>The Open Web Application Security Project (OWASP) is a <a href="http://www.irs.gov/Charities-&-Non-Profits/Charitable-Organizations/Exemption-Requirements-Section-501(c)(3)-Organizations">501(c)(3)</a> worldwide not-for-profit charitable organization focused on improving the security of software. </p>
          </div>

          <div class="sidebar-module">
                        <h4>Quick Links</h4>
                        <ol class="list-unstyled">
                          <li><a href="./gettingstart.html">Getting Started</a></li>
                        </ol>
            
                        <h4>Related Articles</h4>
                        <ol class="list-unstyled">
                          <li><a href="./filteringishard.html">Filtering is Hard!</a></li>
                          <li><a href="./blindlyescaping.html">Blindly-escaping is Insufficient</a></li>
                          <li><a href="./safejstemplating.html">Automatic Contextual Escaping</a></li>
                          <li>&nbsp; - <a href="./contextparser.html">Context Parser</a></li>
                          <li>&nbsp; - <a href="https://github.com/yahoo/xss-filters/blob/master/README.md">XSS Filters</a></li>
                        </ol>
            
                        <h4>Source Code</h4>
                        <ol class="list-unstyled">
                          <li><a href="https://github.com/yahoo/express-secure-handlebars">Express Secure Handlebars</a></li>
                          <li><a href="https://github.com/yahoo/secure-handlebars">Secure Handlebars</a></li>
                          <li><a href="https://github.com/yahoo/secure-handlebars-helpers">Secure Handlebars Helpers</a></li>
                          <li><a href="https://github.com/yahoo/context-parser">Context Parser</a></li>
                          <li><a href="https://github.com/yahoo/xss-filters">XSS Filters</a></li>
                        </ol>

            <h4>References</h4>
            <ol class="list-unstyled">
            <li><a href="https://www.owasp.org/index.php/Main_Page">OWASP</a></li>
            </ol>

          </div>

          <a class="back-to-top" href="#top">
          Back to top
          </a>
        </div><!-- col-md-3 col-md-offset-1 blog-sidebar-->

        <div class="col-md-12 blog-post">
          <div class="security-cta">
            <form action="./blindlyescaping.html" method="get">
              <button type="submit">Blindly-escaping is insufficient</button>
            </form>
          </div>
          <p class="text-center"><a href="./">Back</a> | <a href="/safejstemplating.html">Jump to the solution</a></p>
        </div> <!-- blog post -->     

      </div><!-- row -->
    </div><!-- container -->

    <div class="footer">
    <a href="https://policies.yahoo.com/us/en/yahoo/privacy/index.htm" target="_blank">Privacy</a> |
    <a href="https://policies.yahoo.com/us/en/yahoo/terms/utos/index.htm" target="_blank">Legal</a>
    </div>
        <!-- Bootstrap core JavaScript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="javascripts/jquery.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="javascripts/bootstrap.min.js"></script>
    
        <script src="javascripts/docs.min.js"></script>
        <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
        <script src="javascripts/ie10-viewport-bug-workaround.js"></script>
    
      </body>
    </html>
